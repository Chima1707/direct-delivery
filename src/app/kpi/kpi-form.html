<div class="page-header">
  <h1>Facility KPI</h1>
</div>
<div class="panel panel-default">
  <div class="panel-body">
    <a ui-sref="facilityKPIListView"
       class="btn btn-primary btn-lg">
      <i class="fa fa-list"></i>
      <span>View Status</span>
    </a>
    <br/><br/>
    <a ui-sref="home.schedule"
       class="btn btn-default btn-lg btn-block">
      <i class="fa fa-arrow-circle-left"></i>
      <span>Back</span>
    </a>

    <br/>

    <div class="row">
      <div class="col-sm-6">
        <label>KPI Date</label>
        <input type="date"
               ng-change="facKPICtrl.getByDriverAndDate()"
               class="form-control input-lg"
               ng-value="facKPICtrl.selectedDate"
               ng-model="facKPICtrl.selectedDate"/>
      </div>

      <div class="col-sm-6">
        <label>Facility</label>
        <select class="form-control input-lg"
                ng-change="facKPICtrl.getFacilityKPI()"
                ng-model="facKPICtrl.selectedFacilityId">
          <option value="" ng-selected="true">Select facility</option>
          <option ng-repeat="kpi in facKPICtrl.kpiList"
                  ng-value="kpi.facility.id"> {{ kpi.facility.name }}
          </option>
        </select>
      </div>
    </div>

    <div class="page-header">
      <h1 ng-bind="facKPICtrl.selectedFacility.name"></h1>
    </div>

    <div class="row" ng-show="!facKPICtrl.isValidKPI() && facKPICtrl.selectedFacility !== null">
      <div class="col-sm-12">
        <div class="alert alert-info" role="alert">
          There is no facility KPI available for selected facility!
        </div>
      </div>
    </div>

    <div class="row" ng-if="facKPICtrl.isValidKPI()">
      <form name="kpiForm">
        <table class="table table-striped table-condensed table-bordered">
          <tr>
            <th class="col-sm-6">Antigen</th>
            <th class="col-sm-6">No. of people immunized</th>
          </tr>
          <tr ng-repeat="antigen in facKPICtrl.facilityKPI.antigensKPI track by $index">
            <td><span ng-bind="antigen.productID"></span></td>
            <td>
              <input type="number"
                     class="form-control input-lg remove-pad right-align"
                     min="0"
                     name="{{$index}}"
                     ng-require="true"
                     ng-change="facKPICtrl.isInvalid($index)"
                     ng-model="facKPICtrl.facilityKPI.antigensKPI[$index].noImmunized"
                     step="1"
                     ng-model-options="{ debounce: 0 }"/>

              <span class="alert-danger"
                    ng-show="facKPICtrl.kpiError.antigensNoImmunized[$index] === true && !kpiForm.$index.$pristine">
                <em>
                  <i class="fa fa-exclamation-circle"></i>
                  Please, enter number of people immunized.
                </em>
              </span>
            </td>
          </tr>
        </table>

        <div class="form-group">
          <label>No. of Outreach Sessions
            <input type="number" class="form-control input-lg remove-pad right-align"
                   ng-model="facKPICtrl.facilityKPI.outreachSessions"
                   ng-change="facKPICtrl.isValidOutreach()"
                   min="0"
                   step="1">
          </label>
          <br/>
        <span class="alert-danger"
              ng-show="facKPICtrl.kpiError.outreach === true">
            <em>
              <i class="fa fa-exclamation-circle"></i>
              Please, enter number of outreach sessions.
            </em>
        </span>
        </div>
        <div class="form-group">
          <label>Notes (optional) </label>
          <textarea class="form-control"
                    ng-model="facKPICtrl.facilityKPI.notes"
                    ng-disabled="facKPICtrl.previewKPI"
                    rows="3">
          </textarea>
        </div>
        <button type="button"
                class="btn btn-success btn-lg btn-block"
                ng-show="!facKPICtrl.previewKPI"
                ng-click="facKPICtrl.preview()">
          <span>Preview</span>
          <i class="fa fa-arrow-circle-right"></i>
        </button>
      </form>
    </div>

  </div>
</div>
